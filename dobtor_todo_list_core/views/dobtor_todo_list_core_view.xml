<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record model="ir.ui.view" id="dobtor_todo_list_core_form">
            <field name="name">dobtor.todo.list.core.form</field>
            <field name="model">dobtor.todo.list.core</field>
            <field name="arch" type="xml">
                <form string="Todo list Message">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="todo,done,cancel" options="{'clickable': '1'}"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_get_attachment_view" class="oe_stat_button" icon="fa-book" type="object">
                                <field name="attachment_number" widget="statinfo" string="Documents"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1 class="o_row">
                                <field name="name" placeholder="Todo List..."/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name='creater' readonly="True"/>
                                <field name="user_id"/>
                                <field name="reviewer_id" options="{'no_open': True}"/>
                                <field name="ref_model" widget='reference' string="Mission"/>
                                <field name="parent_model" onchange="0" readonly="True"/>
                                <field name="tag_ids" widget="many2many_tags"/>
                            </group>
                            <group string="Time and Date">
                                <field name="date_assign"/>
                                <field name="date_deadline"/>
                                <field name="date_complete"/>
                                <field name="planned_hours" widget="float_time"/>
                            </group>
                        </group>

                        <notebook>
                            <page name="description_page" string="Description">
                                <field name="description"/>
                                <div class="oe_clear"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="todo_list_core_treeview">
            <field name="name">dobtor.todo.list.core.tree</field>
            <field name="model">dobtor.todo.list.core</field>
            <field name="arch" type="xml">
                <tree string="todo_list_tree" colors="red:out_of_deadline==True;blue:planned_hours==0">
                    <field name="id" invisible="True"/>
                    <field name="sequence" widget="handle"/>
                    <field name="ref_parent_model_name"/>
                    <field name="ref_model_name"/>
                    <field name="name"/>
                    <field name="user_id" options="{'no_open': True}"/>
                    <field name="reviewer_id"/>
                    <field name="date_deadline"/>
                    <field name="out_of_deadline" invisible="True"/>
                    <field name="planned_hours" invisible="True"/>
                    <field name="state" attrs="{'invisible':[('id', '=', False)]}" readonly="True"/>
                    <field name="hide_button" invisible="True"/>
                    <button name="change_state_done" string="Change state to DONE" type="object" icon="fa-check" attrs="{'invisible': [ '|', '|','|',('user_id','=',False), ('state', 'in',['done', 'cancelled']), ('hide_button', '=', True), ('id', '=', False)]}"/>
                    <button name="change_state_todo" string="Change state to TODO" type="object" icon="fa-file" attrs="{'invisible': [ '|', '|','|',('user_id','=',False),('state', '=', 'todo'), ('hide_button', '=', True), ('id', '=', False)]}"/>
                    <button name="change_state_waiting" type="object" string="Change state to WAITING" icon="fa-pause" attrs="{'invisible': [ '|', '|','|',('user_id','=',False),('state', '=', 'waiting'), ('hide_button', '=', True), ('id', '=', False)]}"/>
                    <button name="change_state_cancelled" type="object" string="Change state to CANCELLED" icon="fa-ban" attrs="{'invisible': [ '|', '|','|',('user_id','=',False),('state', '=', 'cancelled'), ('hide_button', '=', True), ('id', '=', False)]}"/>
                    <field name="attachment_number" invisible="True"/>
                    <button name="action_get_attachment_view" string="View Attached Documents" type="object" icon="fa-paperclip" attrs="{'invisible': [('attachment_number', '=', 0)]}"/>
                </tree>
            </field>
        </record>

        <record id="todo_list_core_calendar_view" model="ir.ui.view">
            <field name="name">dobtor.todo.list.core.calendar</field>
            <field name="model">dobtor.todo.list.core</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar date_start="date_deadline" string="Todo" mode="month" color="user_id">
                    <field name="name"/>
                    <field name="user_id"/>
                </calendar>
            </field>
        </record>
        <!-- kanban view -->
        <record model="ir.ui.view" id="todo_list_core_kanban_view">
            <field name="name">dobtor.todo.list.core.kanban</field>
            <field name="model">dobtor.todo.list.core</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" class="o_kanban_small_column" on_create="quick_create">
                    <field name="stage_id"/>
                    <field name="user_id"/>
                    <field name="sequence"/>
                    <field name="reviewer_id"/>
                    <field name="date_deadline"/>
                    <progressbar field="state" colors='{"done": "success", "cancelled": "danger","todo":"warning"}'/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                            <br/>
                                            <small class="o_kanban_record_subtitle text-muted">
                                                <field name="parent_model" invisible="context.get('ref_id', False)"/>
                                                <t t-if="record.date_deadline.raw_value and record.date_deadline.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                                <span t-attf-class="#{red || ''}">
                                                    <i>
                                                        <field name="date_deadline"/>
                                                    </i>
                                                </span>
                                            </small>
                                        </div>
                                        <div class="o_dropdown_kanban dropdown" groups="base.group_user">
                                            <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                                <span class="fa fa-ellipsis-v"/>
                                            </a>
                                            <div class="dropdown-menu" role="menu">
                                                <a t-if="widget.editable" role="menuitem" type="edit" class="dropdown-item">Edit Todo</a>
                                                <a t-if="widget.deletable" role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <field name="ref_model" invisible="context.get('ref_id', False)"/>
                                        <field name="tag_ids" widget="many2many_tags"/>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div>
                                            <field name="state" widget="state_selection" groups="base.group_user"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">

                                            <label for="user_id"/>
                                            <field name="user_id"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear"></div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <!-- menu action -->
        <record id="action_view_todo_list" model="ir.actions.act_window">
            <field name="name">Todo-List</field>
            <field name="res_model">dobtor.todo.list.core</field>
            <field name="view_mode">tree,form,kanban,calendar</field>
            <field name="context">{'search_default_done_todo_list': 1}</field>
        </record>

        <!-- top menu -->
        <menuitem name="Todo List" id="menu_dobtor_todo_list_management"/>

        <!-- left side menu -->
        <menuitem name="Todo List" parent="dobtor_todo_list_core.menu_dobtor_todo_list_management" id="menu_dobtor_todo_list_subItem" action="action_view_todo_list"/>

    </data>
</odoo>
